# 파일 API 엔드포인트 분석 및 Task 체크리스트

## 1. 엔드포인트 추출 결과

### 파일 그룹 관리 API (6개)
1. `GET /files/` - 파일 그룹 목록 조회
2. `GET /files/statistics` - 파일 통계 조회
3. `GET /files/{atch_file_id}` - 파일 그룹 상세 조회
4. `POST /files/` - 파일 그룹 생성
5. `PUT /files/{atch_file_id}` - 파일 그룹 수정
6. `DELETE /files/{atch_file_id}` - 파일 그룹 삭제

### 파일 상세 관리 API (9개)
1. `GET /file-details/details` - 파일 목록 조회
2. `GET /file-details/statistics` - 파일 유형별 통계 조회
3. `GET /file-details/{file_sn}` - 파일 상세 조회
4. `POST /file-details/upload` - 파일 업로드
5. `GET /file-details/{file_sn}/download` - 파일 다운로드
6. `PUT /file-details/{file_sn}` - 파일 정보 수정
7. `DELETE /file-details/{file_sn}` - 파일 삭제
8. `POST /file-details/validate` - 파일 검증
9. `POST /file-details/cleanup-orphaned` - 고아 파일 정리

---

## 2. 엔드포인트별 구현 Task 체크리스트

### 2.1 파일 그룹 관리 API

#### 2.1.1 GET /files/ - 파일 그룹 목록 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.1.1 | 페이징 파라미터 검증 | skip, limit 파라미터 유효성 검사 | 올바른 범위의 파라미터만 허용 |
| 1.1.2 | 검색 기능 구현 | search 파라미터로 파일 그룹 검색 | 검색어가 포함된 파일 그룹 반환 |
| 1.1.3 | 데이터베이스 조회 | FileService를 통한 파일 그룹 목록 조회 | 페이징된 파일 그룹 목록 반환 |
| 1.1.4 | 응답 모델 매핑 | FilePagination 스키마로 응답 변환 | 구조화된 JSON 응답 |
| 1.1.5 | 예외 처리 | 데이터베이스 오류 및 기타 예외 처리 | 적절한 HTTP 상태 코드와 오류 메시지 |

#### 2.1.2 GET /files/statistics - 파일 통계 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.2.1 | 통계 데이터 수집 | 파일 그룹 관련 통계 정보 수집 | 총 파일 수, 크기 등 통계 데이터 |
| 1.2.2 | 통계 계산 로직 | 파일 그룹별, 유형별 통계 계산 | 정확한 통계 수치 |
| 1.2.3 | 응답 모델 매핑 | FileStatistics 스키마로 응답 변환 | 구조화된 통계 JSON 응답 |
| 1.2.4 | 캐싱 구현 | 통계 데이터 캐싱으로 성능 최적화 | 빠른 응답 시간 |
| 1.2.5 | 예외 처리 | 통계 계산 오류 처리 | 적절한 오류 응답 |

#### 2.1.3 GET /files/{atch_file_id} - 파일 그룹 상세 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.3.1 | 파라미터 검증 | atch_file_id 유효성 검사 | 올바른 형식의 ID만 허용 |
| 1.3.2 | 파일 그룹 조회 | 지정된 ID로 파일 그룹 조회 | 파일 그룹 정보 반환 |
| 1.3.3 | 파일 목록 조회 | 해당 그룹의 파일 상세 목록 조회 | 연관된 파일 목록 반환 |
| 1.3.4 | 응답 모델 매핑 | FileWithDetails 스키마로 응답 변환 | 파일 그룹과 파일 목록이 포함된 응답 |
| 1.3.5 | 404 처리 | 존재하지 않는 파일 그룹 처리 | 404 Not Found 응답 |

#### 2.1.4 POST /files/ - 파일 그룹 생성
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.4.1 | 요청 데이터 검증 | FileCreate 스키마 유효성 검사 | 올바른 형식의 데이터만 허용 |
| 1.4.2 | 중복 확인 | atch_file_id 중복 검사 | 고유한 ID만 허용 |
| 1.4.3 | 파일 그룹 생성 | 새로운 파일 그룹 데이터베이스 저장 | 파일 그룹 생성 완료 |
| 1.4.4 | 응답 모델 매핑 | FileResponseSchema로 응답 변환 | 생성된 파일 그룹 정보 반환 |
| 1.4.5 | 중복 오류 처리 | 이미 존재하는 ID 처리 | 400 Bad Request 응답 |

#### 2.1.5 PUT /files/{atch_file_id} - 파일 그룹 수정
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.5.1 | 파라미터 검증 | atch_file_id와 FileUpdate 데이터 검증 | 올바른 형식의 데이터만 허용 |
| 1.5.2 | 파일 그룹 존재 확인 | 수정할 파일 그룹 존재 여부 확인 | 존재하는 파일 그룹만 수정 허용 |
| 1.5.3 | 파일 그룹 수정 | 파일 그룹 정보 업데이트 | 수정된 파일 그룹 정보 |
| 1.5.4 | 응답 모델 매핑 | FileResponseSchema로 응답 변환 | 수정된 파일 그룹 정보 반환 |
| 1.5.5 | 404 처리 | 존재하지 않는 파일 그룹 처리 | 404 Not Found 응답 |

#### 2.1.6 DELETE /files/{atch_file_id} - 파일 그룹 삭제
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 1.6.1 | 파라미터 검증 | atch_file_id 유효성 검사 | 올바른 형식의 ID만 허용 |
| 1.6.2 | 파일 그룹 존재 확인 | 삭제할 파일 그룹 존재 여부 확인 | 존재하는 파일 그룹만 삭제 허용 |
| 1.6.3 | 연관 파일 확인 | 파일 그룹에 속한 파일들 확인 | 연관 파일 목록 파악 |
| 1.6.4 | 소프트 삭제 실행 | 파일 그룹 소프트 삭제 처리 | 삭제 플래그 설정 완료 |
| 1.6.5 | 삭제 확인 응답 | 삭제 완료 메시지 반환 | 성공 메시지 응답 |

### 2.2 파일 상세 관리 API

#### 2.2.1 GET /file-details/details - 파일 목록 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.1.1 | 쿼리 파라미터 검증 | skip, limit, 필터 파라미터 검증 | 올바른 파라미터만 허용 |
| 2.1.2 | 필터링 로직 구현 | atch_file_id, search, file_extsn 필터링 | 조건에 맞는 파일만 조회 |
| 2.1.3 | 데이터베이스 조회 | FileDetailService를 통한 파일 목록 조회 | 필터링된 파일 목록 반환 |
| 2.1.4 | 페이징 처리 | skip, limit을 이용한 페이징 구현 | 페이징된 결과 반환 |
| 2.1.5 | 응답 모델 매핑 | FileDetailPagination 스키마로 변환 | 구조화된 JSON 응답 |

#### 2.2.2 GET /file-details/statistics - 파일 유형별 통계 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.2.1 | 파일 유형 분류 | 파일 확장자별 분류 로직 | 유형별 파일 분류 완료 |
| 2.2.2 | 통계 계산 | 유형별 파일 수, 크기 계산 | 정확한 통계 수치 |
| 2.2.3 | 응답 데이터 구성 | 통계 정보를 dict 형태로 구성 | 유형별 통계 데이터 |
| 2.2.4 | 캐싱 구현 | 통계 데이터 캐싱 | 빠른 응답 시간 |
| 2.2.5 | 예외 처리 | 통계 계산 오류 처리 | 적절한 오류 응답 |

#### 2.2.3 GET /file-details/{file_sn} - 파일 상세 조회
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.3.1 | 파라미터 검증 | file_sn 유효성 검사 | 올바른 숫자 형식만 허용 |
| 2.3.2 | 파일 조회 | 지정된 file_sn으로 파일 조회 | 파일 상세 정보 반환 |
| 2.3.3 | 응답 모델 매핑 | FileDetailResponse 스키마로 변환 | 구조화된 파일 정보 응답 |
| 2.3.4 | 404 처리 | 존재하지 않는 파일 처리 | 404 Not Found 응답 |
| 2.3.5 | 권한 확인 | 파일 접근 권한 검사 | 권한이 있는 사용자만 접근 허용 |

#### 2.2.4 POST /file-details/upload - 파일 업로드
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.4.1 | 파일 그룹 확인 | atch_file_id로 파일 그룹 존재 확인 | 유효한 파일 그룹만 허용 |
| 2.4.2 | 파일 검증 | 파일 크기, 확장자, 형식 검증 | 허용된 파일만 업로드 |
| 2.4.3 | 파일 저장 | 물리적 파일 저장 및 경로 생성 | 파일 저장 완료 |
| 2.4.4 | 데이터베이스 저장 | 파일 메타데이터 데이터베이스 저장 | 파일 정보 저장 완료 |
| 2.4.5 | 응답 생성 | FileUploadResponse로 결과 반환 | 업로드 성공 응답 |

#### 2.2.5 GET /file-details/{file_sn}/download - 파일 다운로드
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.5.1 | 파일 존재 확인 | file_sn으로 파일 정보 조회 | 파일 메타데이터 반환 |
| 2.5.2 | 물리적 파일 확인 | 서버에 실제 파일 존재 여부 확인 | 파일 존재 확인 완료 |
| 2.5.3 | 다운로드 기록 | 다운로드 이력 데이터베이스 저장 | 다운로드 로그 저장 |
| 2.5.4 | 파일 응답 생성 | FileResponse로 파일 스트림 반환 | 파일 다운로드 시작 |
| 2.5.5 | 권한 및 오류 처리 | 접근 권한 및 파일 없음 처리 | 적절한 오류 응답 |

#### 2.2.6 PUT /file-details/{file_sn} - 파일 정보 수정
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.6.1 | 파라미터 검증 | file_sn과 FileDetailUpdate 데이터 검증 | 올바른 형식의 데이터만 허용 |
| 2.6.2 | 파일 존재 확인 | 수정할 파일 존재 여부 확인 | 존재하는 파일만 수정 허용 |
| 2.6.3 | 파일 정보 수정 | 파일 메타데이터 업데이트 | 수정된 파일 정보 |
| 2.6.4 | 응답 모델 매핑 | FileDetailResponse로 응답 변환 | 수정된 파일 정보 반환 |
| 2.6.5 | 권한 및 404 처리 | 접근 권한 및 존재하지 않는 파일 처리 | 적절한 오류 응답 |

#### 2.2.7 DELETE /file-details/{file_sn} - 파일 삭제
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.7.1 | 파라미터 검증 | file_sn과 delete_physical 파라미터 검증 | 올바른 파라미터만 허용 |
| 2.7.2 | 파일 존재 확인 | 삭제할 파일 존재 여부 확인 | 존재하는 파일만 삭제 허용 |
| 2.7.3 | 물리적 파일 삭제 | delete_physical=true인 경우 실제 파일 삭제 | 물리적 파일 삭제 완료 |
| 2.7.4 | 데이터베이스 삭제 | 파일 메타데이터 삭제 또는 소프트 삭제 | 데이터베이스에서 파일 정보 삭제 |
| 2.7.5 | 삭제 확인 응답 | 삭제 완료 메시지 반환 | 성공 메시지 응답 |

#### 2.2.8 POST /file-details/validate - 파일 검증
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.8.1 | 파라미터 검증 | filename과 file_size 파라미터 검증 | 올바른 파라미터만 허용 |
| 2.8.2 | 파일명 검증 | 파일명 형식 및 확장자 검증 | 허용된 파일명만 통과 |
| 2.8.3 | 파일 크기 검증 | 최대 파일 크기 제한 검증 | 허용된 크기만 통과 |
| 2.8.4 | 보안 검증 | 악성 파일 및 보안 위험 검증 | 안전한 파일만 통과 |
| 2.8.5 | 검증 결과 반환 | FileValidationResponse로 결과 반환 | 검증 성공/실패 결과 |

#### 2.2.9 POST /file-details/cleanup-orphaned - 고아 파일 정리
| 단계번호 | Task 이름 | 설명 | 예상 결과 |
|---------|-----------|------|----------|
| 2.9.1 | 업로드 디렉토리 스캔 | 물리적 파일 목록 조회 | 서버의 모든 파일 목록 |
| 2.9.2 | 데이터베이스 파일 목록 조회 | 데이터베이스에 등록된 파일 목록 조회 | DB에 등록된 파일 목록 |
| 2.9.3 | 고아 파일 식별 | 물리적 파일과 DB 파일 비교 | 고아 파일 목록 식별 |
| 2.9.4 | 고아 파일 삭제 | 식별된 고아 파일들 물리적 삭제 | 고아 파일 삭제 완료 |
| 2.9.5 | 정리 결과 반환 | 정리된 파일 수 반환 | 정리 완료 메시지 |

---

## 3. 구현 우선순위

### 높은 우선순위 (Core 기능)
1. 파일 그룹 생성/조회/수정/삭제 (1.4, 1.3, 1.5, 1.6)
2. 파일 업로드/다운로드 (2.4, 2.5)
3. 파일 목록 조회 (1.1, 2.1)
4. 파일 검증 (2.8)

### 중간 우선순위 (관리 기능)
1. 파일 정보 수정/삭제 (2.6, 2.7)
2. 파일 상세 조회 (2.3)
3. 통계 조회 (1.2, 2.2)

### 낮은 우선순위 (유지보수 기능)
1. 고아 파일 정리 (2.9)

---

## 4. 공통 요구사항

### 4.1 보안 요구사항
- 모든 엔드포인트에 인증 필요 (get_current_user)
- 파일 업로드 시 보안 검증
- 파일 다운로드 시 권한 확인
- SQL 인젝션 방지

### 4.2 성능 요구사항
- 페이징 처리로 대용량 데이터 처리
- 통계 데이터 캐싱
- 파일 업로드/다운로드 최적화

### 4.3 오류 처리 요구사항
- 일관된 HTTP 상태 코드 사용
- 명확한 오류 메시지 제공
- 예외 상황별 적절한 처리

### 4.4 로깅 요구사항
- 파일 업로드/다운로드 로그
- 오류 발생 시 상세 로그
- 사용자 활동 추적